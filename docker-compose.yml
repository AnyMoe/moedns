version: '3'

services:
  moedns:
    cap_add:
      - NET_ADMIN
    container_name: moedns
    build: ./.docker/
    image: dglinux/moedns:1.0
    environment:
      - CN_DNS1=101.226.4.6
      - CN_DNS2=119.29.29.29
    ports:
      - "53:53/tcp"
      - "53:53/udp"
    restart: always
    volumes:
      - ./volumes/etc/unbound:/etc/unbound
      - ./volumes/var/log:/var/log

  doh:
    container_name: doh
    build: ./doh/
    image: doh:2.1.1
    ports:
      - "127.0.0.1:8053:8053/tcp"
      - "127.0.0.1:8053:8053/udp"
    restart: always
    volumes:
      - ./volumes/etc/dns-over-https/doh-server.conf:/etc/dns-over-https/doh-server.conf
